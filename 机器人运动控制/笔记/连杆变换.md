# 连杆变换
末端连杆相对于基座的位姿关系，由连杆变换依次相乘得到
## D-H参数
关节轴线:第$i$个关节的轴线记为$J_i$
连杆参数:
  * 连杆长度:两个关节的关节轴线$J_i$与$J_{i+1}$的公垂线距离为连杆长度，记为$a_i$
  * 连杆扭转角:由$J_i$与公垂线组成平面P，$J_{i+1}$ 与平面P的夹角为连杆扭转角，记为$ \alpha_i$
  这里的公垂线指的是$J_i$与$J_{i+1}$间的公垂线
  * 连杆偏移量:除第一和最后连杆外，中间的连杆的两个关节轴线$J_i$与$J_{i+1}$间都有一条公垂线，一个关节的相邻两条公垂线$a_i$与$a_{i-1}$的距离为连杆偏移量，记为$d_i$
  * 关节角:关节$J_i的$相邻两条公垂线$a_i$与$a_{i-1}$在以$J_i$为法线的平面上的投影的夹角为关节角，记为$\theta_i$

$(ai, \alpha_i, di, \theta_i)$这组参数称为D-H参数

![](img/1.png)
## 连杆变换矩阵
### 坐标系的建立
以上图为例，我们有两个连杆，三个关节，那么坐标系的建立无非就有三种情况:
1. 在非首尾连杆$C_i$处建立坐标系
     * 原点$O_i$:取关节轴线$J_i$与$J_{i+1}$与公垂线交点作为原点。由于交点有两个，也有两种原地取法，在这里是在$J_{i+1}$处建立原点
     * $Z_i$ 轴:取关节轴线方向作为 $Z_i$ 轴，这里就是取$J_{i+1}$
     * $X_i$ 轴:取公垂线指向方向，即沿着公垂线指向下一个连杆的方向
     * $Y_i$ 轴:根据右手定则确定，个人理解为四指环绕方向为X到Y方向，拇指指向Z的方向

2. 在第一连杆$C_1$建立坐标系
     * 原点$O_i$:取基坐标系原点
     * $Z_i$ 轴:取$J_1$方向
     * $X_i$ 轴:任选
     * $Y_i$ 轴:根据右手定则确定
3. 在最后连杆$C_n$建立坐标系
     * 原点$O_i$:取末端抓手中心点
     * $Z_i$ 轴:取抓手朝向
     * $X_i$ 轴:抓手一个指尖到另一个指尖
     * $Y_i$ 轴:根据右手定则确定

下图展示的是在$J_{i+1}$处建立原点的示意图，实际上我们只需要掌握在$C_i$处建立坐标系就可以了
![](img/1_1.png)
请注意，上图是在$J_{i+1}$处建立原点，也就是说我的$C_i$坐标系是在$J_{i+1}$处建立原点的原点。对应上图，$J_i$处原点是$C_{i-1}$的，$J_{i+1}$处原点是$C_i$的

### 矩阵的形成
那么我要想将$C_{i-1}$坐标系变为$C_i$坐标系，需要经历如下几个变换步骤:
1. 以$Z_{i-1}$轴为转轴，旋转$\theta_i$角度，使旋转后的的$X_{i-1}$轴与$X_i$轴同向
2. 沿$Z_{i-1}$轴平移$d_i$，使移动后的$O_{i-1}$移动到关节轴线$J_i$与$J_{i+1}$的公垂线在与$J_i$的交点。其实就是往上移动了一下，移动到$O_i$一个高度去了
3. 沿新的(旋转后)的$X_{i-1}$轴平移$a_i$，使新的$O_{i-1}$移动到$O_i$ 
4. 以$X_i$轴为转轴，旋转$\alpha_i$角度，使新的$Z_{i-1}$轴与$Z_i$轴同向

我们按照上述步骤，可以得到旋转变换矩阵，值得注意的是，每次进行变换的时候他们都不是在一个坐标系下进行的，所以是连体坐标系，他们之间是右乘的关系
![](img/1_2.png)

