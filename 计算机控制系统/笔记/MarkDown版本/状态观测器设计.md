# 状态观测器设计及反馈应用
在上节中基于状态反馈设计中，是对系统的全状态进行反馈，但是在实际中测量系统所有的状态向量是困难的，甚至是不可能的。那么我能否想办法得到一个**预估值**来近似代替我测不到的状态向量呢？

状态观测器的主要思想:对系统进行重构，通过构建观测器，利用系统的控制变量和输出变量，得出系统状态变量的**估计值**
## 状态观测器的设计
### 全维状态观测器
![alt text](img/9_1.png)

全维状态观测器的误差方程为:
$$
观测误差=实际值-观测值\\
\widetilde{x}(k+1)=x(k+1)-\widehat{x}(k+1) \\
=Ax(k)+Bu(k)-[(A-KC)\widehat{x}(k)+Bu(K)+KCx(k)]\\
=(A-KC)\widetilde{x}(k)
$$
经Z变换有:
$$
\widetilde{x}(z)=(zI-A+KC)^{-1}z\widetilde{x}(0)
$$
我们称观测器系统的特征方程为:
$$
\Delta=|zI-A+KC|
$$
我们设计观测器的目标是选择合适的输出误差反馈矩阵K使得状态估计误差系统的所有极点均位于z平面单位圆内，则误差可在有限拍内趋于零，即状态估计值在有限拍内可以跟踪上真实状态，且极点越靠近单位圆状态估计误差趋于零的速度越快，反之越慢

在仅考虑单输入系统条件下:
$$
(z-z_0)(z-z_1)···(z-z_n)=|zI-A+KC|
$$
其中$z_0,z_1···z_n$为**观测器**期望的极点

实际上我观测器是想得到$\widehat{x}_1(k+1)$的值，这个预测值为:
![alt text](img/9_4.png)
### 降维状态观测器
在系统的全部状态中，可能有一部分状态$x_2$，是可以直接在输出端获取其测量值；而另一部分$x_1$，则必须通过观测器来重构以获得估计值，在此处，我们不估计全部的状态而只估计一部分状态，那么这样的观测器就叫将为状态观测器

那么原系统就可以分为如下几个部分:
![alt text](img/9_2.png)
我们将第一行写出来:
$$
x_1(k+1)=A_{11}x_1(k)+A_{12}x_2(k)+b_1u(k)
$$
由于$x_2(k),x_2(k)$均是可以直接测量的，我们可以把二者当作一个整体作为新系统的$u(t)$
我们将第二行写出来，并做一个简单的变形:
$$
x_2(k+1)=A_{21}x_1(k)+A_{22}x_2(k)+b_2u(k)\\
A_{21}x_1(k)=x_2(k+1)-A_{22}x_2(k)-b_2u(k)
$$
由于$x_2(k+1),x_2(k),u(k)$都是可以测量的，那么$A_{21}x_1(k)$相当于是新系统的$z(k)$

即设计降为状态观测器相当于设计下述系统的全维状态观测器:
$$
x_1(k+1)=A_{11}x_1(k)+A_{12}x_2(k)+b_1u(k)\\
z(k)=x_2(k+1)-A_{22}x_2(k)-b_2u(k)
$$
同样的，误差为:
$$
\widetilde{x}_1(k+1)=x_1(k+1)-\widehat{x}_1(k+1)=(A_{11}-KA_{21})\widehat{x}_1(k)
$$

实际上我观测器是想得到$\widehat{x}_1(k+1)$的值，这个预测值为:
![alt text](img/9_3.png)
## 带状态观测器的状态反馈系统
![alt text](img/9_5.png)
在此处，我们为了区分矩阵的区别我们称:
1.状态反馈增益矩阵为$K$
2.观测器输出误差反馈矩阵为$H$

此系统对应的特征方程为:
$$
|zI-A+BK|\cdot|zI-A+HC|=0
$$
闭环系统的2n个极点由两部分组成，一部分是按极点配置设计的控制规律给定的n个极点，称为控制极点，另一部分是按极点配置设计的状态观测器给定的n个极点，称为观测器极点。两部分相互独立，可分别设计 

分离原理:设计基于观测状态的状态反馈控制系统时，对观测器和控制器的设计是分别独立进行的，分别找到状态观测器的特征根方程和闭环系统的特征方程，根据给定的期望极点，分别得到观测器反馈增益矩阵$H$和状态反馈增益矩阵$K$