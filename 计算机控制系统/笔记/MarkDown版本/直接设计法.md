# 直接设计法
计算机控制系统的直接设计法，是先将被控对象和保持器组成的连续部分离散化，然后应用离散控制理论的方法进行分析和综合，直接设计出满足控制指标的离散控制器，用计算机来实现

对于没有纯滞后环节的系统来说，采用最少拍控制系统进行设计
对于带有纯滞后环节的系统来说，采用史密斯预估器与大林算法
## 最少拍控制系统设计
最少拍设计，是指系统在典型输入信号(阶跃、速度、加速度信号)作用下，经过最少拍(有限拍)，使系统输出的稳态误差为零，一般用最少拍来进行设计时，系统是不包含滞后环节的

定义：最小拍控制为时间最优控制，即闭环控制系统在最少的采样周期内达到稳定，且在**采样点上**的输出能够准确地跟踪输入信号，不存在稳态误差

既然是在采样点上能够准确跟踪输入信号，那么不在采样点上呢？
此时，我们可以分为两种情况:
* 有波纹：对任意两次采样时刻间的输出不提任何要求，中间可以随便震荡，只保证系统输出在采样点上误差为0，而采样点之间不保证误差为0
* 无波纹：采样点上及采样点间均能保证误差为0

一般，我们用最少拍设计得到的整个系统是如下图所示:
![alt text](img/6_1.png)
我们为了保证设计简单，一般假设满足以下条件:
* $G(Z)$在单位圆上和圆外无极点，其中$(1,0j)$除外
* $G(Z)$在单位圆上和圆外无零点
* $H_0(Z)$不含纯滞后环节

$G(z)$就是我们前面介绍的广义脉冲传递函数，直接用前面的结论做z变换:
$$
G(z)=\frac{z-1}{z}\mathcal Z[\frac{G_p(s)}{s}]
$$
### 理论推导
**特别提醒，以下设计过程仅供参考，不保证绝对正确，仅提供思路，具体做题请参考最小拍设计章节**
根据上图的流程图，我们先计算传递函数:
$$
\varPhi(z)=\frac{D(z)G(z)}{1+D(z)G(z)}
$$
我们也可以得到误差传递函数:
$$
\varPhi_e=\frac{E(z)}{R(z)}=\frac{1}{1+D(z)G(z)}=1-\varPhi(z)
$$
由于我们是设计控制器，即我们要求$D(z)$，那么根据上述等式，我们把$D(z)$导出来:
$$
D(z)=\frac{\varPhi(z)}{\varPhi_e R(z)}
$$
那么为我们的误差是什么呢？我们用误差传递函数来求:
$$
E(z)=\varPhi_e(z) R(z)
$$
由于我们是在典型输入条件下，那么典型输入长成这样的($A(z)$为不包含$1-z^{-1}$项的多项式):
$$
R(z)=\frac{A(z)}{(1-z^{-1})^q}
$$
带入误差，我们得到:
$$
E(z)=1-\varPhi(z)=\varPhi_e(z)\frac{A(z)}{(1-z^{-1})^q}
$$
不要忘了，上面式子求的是z变换，我们要用终值定理才能真正求出误差:
$$
e(\infty)=\lim_{z\to 1}[(z-1)\varPhi_e(z)\frac{A(z)}{(1-z^{-1})^q}]=0
$$
我们真要是让误差为0，那么$\varPhi_e(z)=(1-z^{-1})^qF(z)$，为什么？
我得把分母搞掉才能将1带进去，最后值为0啊，不然带极点我怎么解？你要硬洛也行，但是我这里是在设计系统，我这么做不是好设计吗？这是最简单方法了
$$
\varPhi_e(z)=(1-z^{-1})^qF(z)
$$
$F(z)$为不含零点z=1的$z^{-1}$多项式，我们将$F(z)$展开:
$$
\varPhi_e(z)=(1-z^{-1})^q(f_0+f_1z^{-1}+f_2z^{-2}···+f_pz^{-p})
$$
我们想要达到最少拍，而且要尽可能简单，干脆$p=0$好了，就留$f_0$，并令$f_0=1$，这样我不就完美的消掉了分母？即:
$$
E(z)=A(z)\\e(\infty)=\lim_{z\to 1}[(z-1)A(z)]=0
$$
### 最少拍有波纹系统设计
前面的其实你完全可以不看，直接看这里，我们在此进行总结，对于典型输入，我们进行设计有:
$$
\varPhi_e(z)=(1-z^{-1})^q\\
\varPhi(z)=1-\varPhi_e(z)=1-(1-z^{-1})^q\\
D(z)=\frac{\varPhi(z)}{\varPhi_e(z)G(z)}=\frac{1}{G(z)}\frac{\varPhi(z)}{1-\varPhi(z)}\\
U(z)=\frac{R(z)\varPhi(z)}{G(z)}
$$
$q$为你输入信号的的阶数加1，也是你系统误差为0时经过的最少拍数；$U(z)$为控制器的输出
![alt text](img/6_2.png)
也就是说给定你输入信号，对照表里数据无脑带上面的公式就可以了，就完成了控制器的设计

很多情况下，我们需要保证控制量$U(z)$是稳定的，即他要收敛，那么根据$U(z)=\frac{R(z)\varPhi(z)}{G(z)}$，需要$G(z)$所有**零点**都在单位圆内
* 零点都在单位圆内，一定稳定
* 零点有在单位圆上和单位圆外，分别为$z_i$，有$k$个
  那么我的$\varPhi(z)$要想办法包含这些零点(根据$U(z)$表达式)，即:
  $$
    \varPhi(z)=(1-z_1z^{-1})···(1-z_kz^{-1})M(z)
  $$
$M(z)$为你上边本来就应该求得的$\varPhi(z)$乘上系数，每一项都乘，如$z^{-1}$变为$m_1z^{-1}$，$2z^{-1}-z^{-2}$变为$m_1z^{-1}-m_2z^{-2}$
$\varPhi(z)$与$\varPhi_e(z)$中$z^{-1}$次数应该是匹配的，所以$\varPhi_e(z)$中的$F(z)$不能仅取第一项，而是要多取一项进行匹配

例题:圆外零点为-2.78，单位阶跃输入
$\varPhi(z)=(1+2.78z^{-1})m_1z^{-1}$
$\varPhi_e(z)=(1-z^{-1})(1+f_1z^{-1})$(注意:$f_0$我们始终取1)
由$\varPhi_e(z)=1-\varPhi(z)$将上述两式带入后待定系数求得未知数

对于不稳定的被控对象设计最小拍，那么就在$\varPhi_e(z)$包含被控对象单位圆外与上的极点
$$
    \varPhi_e(z)=(1-z_1z^{-1})···(1-z_kz^{-1})A(z)
$$
$A(z)$为你本应该求的$\varPhi_e(z)$，令$\varPhi(z)$为对应次数的$M(z)$，待定系数求未知数

### 最少拍无波纹系统设计
无波纹系统设计上与保证控制量稳定类似，只不过$\varPhi(z)$不仅仅要包含不稳定的极点，还要包含单位圆内非0的极点，即:
$$
    \varPhi(z)=(1-z_1z^{-1})···(1-z_kz^{-1})M(z)
$$
然后$\varPhi_e(z)$中$F(z)$要根据$\varPhi(z)$中$z^{-1}$次数多取几项，使其次数匹配，最后待定系数求解未知数
实际上，你也不一定非得要待定系数求解，而是可以采取以下公式:
![alt text](img/6_3.png)
### 阻尼因子法
我们在最小拍控制系统设计的基础上，通过在系统的闭环脉冲传递函数中，引入附加的极点因子，又称为阻尼因子；添加阻尼因子后，系统过渡过程时间增加，但整个系统的输出响应比较平稳，对不同输入信号的适应性有所改善
那么根据上述描述，我们添加阻尼因子后的闭环传递函数$\varPhi_w(z)$为:
$$
1-\varPhi_w(z)=\frac{1-\varPhi(z)}{1-cz^{-1}}
$$
实际上，就是用$\varPhi_w(z)$替代了原来的$\varPhi(z)$，在后续算输出$Y(z)$的时候就用$\varPhi_w(z)$来算了
为了满足系统的稳定性与没有震荡的要求，应取$0<c<1$，通常我们取$c=0.5$
## 纯滞后对象控制算法
上述最少拍设计时，系统是不包含滞后环节$e^{-\tau s}$的，若系统包含滞后环节，则用最少拍系统设计效果并不是很好，这里就要用到史密斯预估器与大林算法
### 史密斯(Smith)预估器
假定被控对象传递函数为:
$$
G_p(s)=G_0(s)e^{-\tau s}
$$
其中$\tau$为采样周期的**整数倍**，$\tau=nT$
一般情况下，我们被控对象前面是要接零阶保持器的，我们带入零阶保持器$H_0$，经过z变换为:
$$
G(z)=z^{-n}H_0G_0(z)=z^{-n}G'(z)
$$
我们控制器仍然用$D(z)$表示，那么有:
![alt text](img/6_4.png)
$$
\varPhi(z)=\frac{D(z)z^{-n}G'(z)}{1+{D(z)z^{-n}G'(z)}}
$$
闭环函数分母存在纯滞后环节，这是我们不想要的，因此我们的目标就是对这个闭环环节进行改造，让他的分母不再包含延迟环节
所以我们假设，将这个过程改成没有延迟环节的理想闭环系统，在其输出加上个延迟环节
![alt text](img/6_5.png)
该理想系统里面，在闭环反馈的回路里已经不包含延时环节了，但由于系统的因果性限制，纯延时特性无法完全消除

我们将二者的闭环传递函数相等，那么就可求出$D(z)$，即为史密斯预估器:
$$
D(z)=\frac{D_0(z)}{1+(1-z^{-n})D(z)G'(z)}
$$
史密斯预估器没法消除延时，但是可以使闭环系统部分不受时延影响，从而保证闭环特性的稳定和动态性能

史密斯预估器实际上是引入了一个与被控对象并联的补偿器$(1-z^{-N})G_0(z)$，使得补偿以后的等效对象不包含纯滞后特性，为$G_0(z)$，通常情况下$D_0(z)$为PID控制器

![alt text](img/6_12.png)

### 大林算法
如果对系统的要求是无超调量或超调量很小，并且允许有较长的调节时间，则大林算法的控制效果往往比PID等控制算法具有更好的效果，同时大林算法也是适用于带纯滞后环节的

我们假设带有滞后环节的控制对象可用带有滞后环节的一二阶惯性环节来表示，我们将器接入零阶保持器，然后用z变换:
* 一阶惯性环节
![alt text](img/6_8.png)
* 二阶惯性环节
![alt text](img/6_9.png)

即你的被控对象如果是一阶的就用上式的一阶惯性环节来算，要是二阶的就用上式二阶惯性环节来算

在大林算法中，无论你是一阶还是二阶，我最终的闭环传递函数都是以下形式:
$$
\varPhi(s)=\frac{1}{T_cs+1}e^{-\tau s}
$$
$\tau$与被控对象中$\tau$的相同($\tau=NT$)，$T_c$为理想闭环系统的一阶惯性时间常数，该常数通过给定的设计目标来求得(设计)
用零阶保持器发进行离散化，就有:
![alt text](img/6_10.png)
零阶保持器法:加入零阶保持器然后进行z变换
  
根据$D(z)=\frac{\varPhi(z)}{\varPhi_e(z)G(z)}=\frac{1}{G(z)}\frac{\varPhi(z)}{1-\varPhi(z)}$，我们可以求出$D(z)$，那么有:
* 一阶惯性环节
![alt text](img/6_6.png)
* 二阶惯性环节
![alt text](img/6_7.png)

#### 振铃现象
在大林算法中，会出现振铃现象，如下图所示，一种类似于边震荡边收敛
![alt text](img/6_11.png)
对于一阶惯性环节来说，是不存在这种现象的，只有二阶惯性环节才出现这种现象，出现这种现象出现的原因是$D(z)$存在靠近$z=-1$的极点，对此我们有两种改进方法:
1. 选择合适的采样周期$T$及系统闭环时间常数$T_c$，使得数字控制器的输出避免产生强烈的振铃现象
我们通常用$RA$代表振铃强弱，它的定义为:
$$
RA=\frac{c_2}{c_1}-e^{-\frac{T}{T_c}}+e^{-\frac{T}{T_1}}+e^{-\frac{T}{T_2}}
$$
如果给定设计目标的$RA$，那么就可以根据上述式子调节$T、T_c$，以满足设计目标
2. 找出$D(z)$中引起振铃现象的因子，这个因子就是$z=-1$附近的极点，然后令其中的$z=1$；根据终值定理，这样处理不影响输出量的稳态值，但是会影响其动态性能指标
例如$D(z)=\frac{1}{(1+0.995z^{-1})(1-0.795z^{-1})(1-0.765z^{-1})}$，为了消除振铃，那么就变为$D(z)=\frac{1}{1.995(1-0.795z^{-1})(1-0.765z^{-1})}$
